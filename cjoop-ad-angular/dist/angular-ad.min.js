/*! cjoop-ad-angular - v0.0.1 - 2016-03-28
* https://github.com/cjjava/cjoop-ad
* Copyright (c) 2016 cjjava <85309651@qq.com>; Licensed MIT */
!function(a,b){"use strict";function c(){return a.adhost||"localhost:80"}b.module("cjoop.ad",[]).directive("ad",["$http","$timeout",function(a,d){return{scope:{},template:function(a,c){var d=c.bindModel;if(!d)throw new Error("The bind-model must not be null");var e=d.split(","),f=new Array(e.length);return f.push('<div class="ad-wrapper">'),b.forEach(e,function(a,b){f.push('<select ng-change="change('+b+')" class="ad-select" ng-model="'+a+'" ng-options="'+a+".name for "+a+" in "+a+'s"></select>\n')}),f.push("</div>"),f.join("")},link:function(e,f,g){var h=g.bindModel,i=h.split(","),j=e.$parent,k={code:"",name:"请选择",$$index:-1};b.forEach(i,function(a){e[a+"s"]=[k],e[a]=k}),e.refreshADInfo=function(d,f){f<i.length&&a.get("http://"+c()+"/ad/"+d+"/childs").then(function(a){var c=a.data;b.forEach(c,function(a){a.$$index=f}),c.unshift(k),e[i[f]+"s"]=c,e[i[f]]=k;for(var d=f+1;d<i.length;d++)e[i[d]+"s"]=[k],e[i[d]]=k})},e.refreshADInfo(0,0),e.change=function(a){var b=i[a],c=e[b];e.refreshADInfo(c.id,a+1),j[b]=c};for(var l=function(a){d(function(){if(a)for(var b=a.$$index,c=e[i[b]+"s"],d=0;d<c.length;d++){var f=c[d];if(f.id===a.id){e[i[b]]=f,e.refreshADInfo(f.id,b+1);break}}},0)},m=0;m<i.length;m++)j.$watch(i[m],l)}}}])}(window,window.angular);